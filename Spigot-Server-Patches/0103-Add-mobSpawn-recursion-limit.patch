From f39c28a062dcb6a97bad9499692ce36f49e48461 Mon Sep 17 00:00:00 2001
From: frash23 <jacob@bytesizedpacket.com>
Date: Mon, 16 May 2016 23:17:04 +0200
Subject: [PATCH] Add mobSpawn recursion limit


diff --git a/src/main/java/net/minecraft/server/SpawnerCreature.java b/src/main/java/net/minecraft/server/SpawnerCreature.java
index 284f4bf..04ea8eb 100644
--- a/src/main/java/net/minecraft/server/SpawnerCreature.java
+++ b/src/main/java/net/minecraft/server/SpawnerCreature.java
@@ -12,6 +12,8 @@ import org.bukkit.craftbukkit.util.LongHashSet;
 import org.bukkit.event.entity.CreatureSpawnEvent.SpawnReason;
 import org.github.paperspigot.exception.ServerInternalException;
 // CraftBukkit end
+    
+import org.github.paperspigot.PaperSpigotConfig; // Parcot
 
 public final class SpawnerCreature {
 
@@ -64,8 +66,11 @@ public final class SpawnerCreature {
                     b0 = ( b0 > 8 ) ? 8 : b0;
                     // Spigot End
 
+                    int tries = 0;
                     for (int i1 = -b0; i1 <= b0; ++i1) {
                         for (k = -b0; k <= b0; ++k) {
+							if(++tries > PaperSpigotConfig.maxMobSpawnTries) break;
+
                             boolean flag3 = i1 == -b0 || i1 == b0 || k == -b0 || k == b0;
                             // CraftBukkit start - use LongHash and LongHashSet
                             // ChunkCoordIntPair chunkcoordintpair = new ChunkCoordIntPair(i1 + l, k + j);
diff --git a/src/main/java/org/github/paperspigot/PaperSpigotConfig.java b/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
index d6d9899..c729ada 100644
--- a/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
+++ b/src/main/java/org/github/paperspigot/PaperSpigotConfig.java
@@ -222,4 +222,10 @@ public class PaperSpigotConfig
     {
         warnForExcessiveVelocity = getBoolean("warnWhenSettingExcessiveVelocity", true);
     }
+
+    public static int maxMobSpawnTries;
+    private static void maxMobSpawnTries()
+    {
+        maxMobSpawnTries = getInt("max-mobspawn-tries", 80);
+    }
 }
-- 
2.8.2

